<!DOCTYPE html>
<html>

<head>
  <title>ODS Widgets Minimal Boilerplate</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- These are  the required CSS files if you use ODS widgets -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://opendatasoft.github.io/ods-widgets/dist/ods-widgets.css">
</head>

<body>
  <div class="container-fluid" ng-app="ods-widgets">
    <section id="intro">
      <div class="prose">
        <h1>Opendatasotf scrollytelling boilerplate</h1>
        <p>This a little boilerplate that showcases different techniques of scrolly telling you can use with our data. We have more than 20k
          ,000 dataset you can use to tell data driven stories!</p>
        <p>This boilerplate uses the most excellent scrollama lib and takes a lot of inspiration from the Mapbox GL JS scrollytelling template. Be sure to check those out!</p>
      </div>
    </section>
    <ods-dataset-context context="velo" velo-domain="data.opendatasoft.com" velo-dataset="amenagements-velo-en-ile-de-france@datailedefrance">
      <!-- The .step div takes the full screen, inside it you want to place your text etc. which is typically not fullscreen -->
      <section id="ods-map">
        <map id="map-idf" class="ods-map-wrapper">
          <ods-map class="fullscreen-feature" location="10,48.831,2.349" scroll-wheel-zoom="false" display-control="0">
            <ods-map-layer context="velo" color="#128317"></ods-map-layer>
          </ods-map>
        </map>
        <div class="step" data-feature="map-idf">
          <div class="story-block story-block-over lefty">
            <p>This a map from ODS widgets. It will have
              <pre>position:Â fixed;</pre> until this box is out. It uses the default action of this boilerplate:Â add the
              <pre>.active</pre> class to the feature.</p>
          </div>
        </div>
      </section>
      <section id="ods-chart">
        <figure id="chart-idf" class="ods-chart-wrapper">
          <ods-chart class="fullscreen-feature" align-month="true">
            <ods-chart-query context="velo" field-x="highway" maxpoints="50">
              <ods-chart-serie expression-y="osm_id" chart-type="column" function-y="AVG" color="#e74c3c" scientific-display="true">
              </ods-chart-serie>
            </ods-chart-query>
          </ods-chart>
        </figure>
        <div class="step" data-feature="chart-idf">
          <div class="story-block story-block-over centered">
            <p>Sticky is the most common behavior in scrollytelling, but you can add any transition you want. This chart from ODS widgets, slides in and fades. To do that you have to specify callbacks when entering and exiting the step in the
              callback mapping of
              <pre>src/app.js</pre>
            </p>
            <p>You can also style those text box as you wish! Here we centered it ðŸ˜„</p>
          </div>
        </div>
      </section>
    </ods-dataset-context>
    <section id="api-call">
      <div class="prose">
        <h2>External libs</h2>
        <p>You are not limited to ODS widgets either. You can fetch the data with our API and then include it in your favorite JS libs, like mapbox GL JS, Highcharts etc.</p>
      </div>
      <div class="scroll-columns">
        <div id="steps">
          <div class="step" data-feature="api-endpoint">
            <div class="story-block story-block-col">
              <p>To make an API call, first get the base URL of the dataset. It's the same you have in your browser</p>
            </div>
          </div>
          <div class="step" data-feature="api-query">
            <div class="story-block story-block-col">
              <p>Then, you can filter and aggregetate your resluts with an SQL-like syntax. Be sure to load as little data as possible for a faster page!</p>
              <a href="https://help.opendatasoft.com/apis/ods-search-v2/#search-api-v2">See the full documentation here</a>
            </div>
          </div>
          <div class="step" data-feature="api-callback">
            <div class="story-block story-block-col">
              <p>Finally, fetch the data using <code>fetch</code> (or using <a href="https://www.npmjs.com/package/axios">axios</a>) and use the callback to inject your data in your page.</p>
            </div>
          </div>
          <div class="feature-col">
            <pre>
              <code id="api-endpoint" class="language-javascript codeline">const endpoint = 'https://data.opendatasoft.com/api/v2/catalog/datasets/amenagements-velo-en-ile-de-france%40datailedefrance/'</code>
              <code id="api-query" class="language-javascript codeline">const query = 'aggregates?select=sum(longueur) as long_tot, count(*) as num_bikepath&group_by=nom_com&limit=10'</code>
              <code id="api-callback" class="language-javascript codeline">
                fetch(endpoint + query)
                  .then(res => res.json()) //axios.get(â€¦) would avoid that ðŸ˜‰
                  .then(doSomethingWithData)
              </code>
            </pre>
          </div>
        </div>
      </div>
    </section>
    <section id="reveal-list">
      <div class="scroll-columns">
        <div class="step" data-feature="reveal-list">
          <div class="story-block story-block-col">
            <p>Going full JS alows for more complex actions, such as using the progress inside the step. But, if asynchronous JS seems to complicated, you can still do a lot with the ODS widgets ðŸ˜‰.</p>
          </div>
        </div>
        <div id="reveal-list" class="feature-col">
          <h3>Cities with the most bikepaths in Ile-de-France:</h3>
          <ul id="top-cities-bikepath"></ul>
        </div>
      </div>
    </section>
    <section>
      <div class="scroll-columns">
        <div id="mapbox-steps">
          <div class="step" data-feature="mapbox-fly">
            <div class="story-block story-block-col">
              <p>Then you can trigger any callback you want when steps enter and leave. Here we use a <code>flyTo</code> method.</p>
              <p>If you feel async JS is too painful, stick to the ODS widgets, they will do the job for you ðŸ˜„</p>
            </div>
          </div>
          <div class="step" data-feature="mapbox">
            <div class="story-block story-block-col">
              <p>With those APIÂ call, you can fetch data and then inject them into your favorite plugins, like Mapbox GL JS.</p>
            </div>
          </div>
        </div>
        <div class="feature-col">
          <div name="Bikepath of Ile-de-France" id="mapbox"></div>
        </div>
      </div>
    </section>
    <!-- The ".step" is used as a selector for the scroller.
      Whenever it enters/leaves the screen the onStepEnter/onStepExit callback is fired
      data-feature will tell wich element to apply/remove the ".acitve" class on.-->
  </div>

  <!-- These are  the required js library if you use ODS widgets. Carefully test if you are using a framework, since they rely on AngularJS and jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-sanitize.min.js"></script>
  <script type="text/javascript" src="https://opendatasoft.github.io/ods-widgets/dist/ods-widgets.js"></script>
</body>

</html>
