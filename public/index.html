<!DOCTYPE html>
<html>

<head>
  <title>ODS Widgets Minimal Boilerplate</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">
</head>

<body>
  <div class="container" ng-app="ods-widgets">
    <section class="sticky-content">
      <h2 class="text-primary text-center mb-4">
        COVID-19 epidemiliogic status in Castilla y León (last update 17/03/2020)
      </h2>
    </section>
    <ods-dataset-context context="regions,cases" cases-domain="https://analisis.datosabiertos.jcyl.es" cases-dataset="situacion-epidemiologica-coronavirus-en-castilla-y-leon" regions-dataset="limites-provinciales-de-castilla-y-leon-recintos"
      regions-domain="https://analisis.datosabiertos.jcyl.es">
      <div class="row justify-content-around">
        <div id="confirmed-cases" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">confirmed cases</p>
        </div>
        <div id="new-cases" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">confirmed new-cases</p>
        </div>
        <div id="hospitalized" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">hospitalized</p>
        </div>
        <div id="hospitalized-uci" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">hospitalized UCI</p>
        </div>
        <div id="Altas" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">Altas</p>
        </div>
        <div id="fatalities" class="insight-card col-xs-3">
          <h3 class="text-highlight">49</h3>
          <p class="text-light">Fatalities</p>
        </div>
      </div>

      <div class="row feature-box" ng-init="tabselector = 'firsttab'">
        <div class="col-xs-12">
          <div class="tabs">
            <a class="tab" ng-click="tabselector = 'firsttab'" ng-class="{'activetab' : tabselector == 'firsttab'}">
              New cases
            </a>
            <a class="tab" ng-click="tabselector = 'secondtab'" ng-class="{'activetab' : tabselector == 'secondtab'}">
              Hospitalized
            </a>
            <a class="tab" ng-click="tabselector = 'thirdtab'" ng-class="{'activetab' : tabselector == 'thirdtab'}">
              Fatalities
            </a>
          </div>
          <div class="col-xs-12" ng-if="tabselector == 'firsttab'">
            <div ng-init="colors = {};">
              <div ods-analysis="analyseregions"
                ods-analysis-context="cases"
                ods-analysis-x="codigo_ine"
                ods-analysis-max="0"
                ods-analysis-serie-agg="SUM(casos_confirmados)"
                ods-analysis-sort="agg">
                <div ods-subaggregation="analyseregions.results"
                  ods-subaggregation-serie-maxval="MAX(agg)"
                  ods-subaggregation-serie-minval="MIN(agg)">
                  <span ng-repeat="res in analyseregions.results">
                    {{reg_code = res.x > 9999 ? (res.x | limitTo:2) : (res.x | limitTo:1)}}
                    {{colors[reg_code] = "hsl(220,75%," + (75 - ((res.agg - results[0].minval) / (results[0].maxval - results[0].minval) * 50) | number : 0) + "%,1)"; "" }}
                  </span>
                </div>
              </div>
                <ods-map basemap="jawg.light" no-refit="false" scroll-wheel-zoom="false" display-control="false" display-control-single-layer="true" toolbar-fullscreen="true" toolbar-drawing="false">
                  <ods-map-layer context="regions" color-categories="colors" color-by-field="cod_ine_prov" color-categories-other="lightgrey" display="categories" shape-opacity="0.7" tooltip-disabled="true"></ods-map-layer>
                </ods-map>
            </div>
          </div>
          <div class="col-xs-12" ng-if="tabselector == 'secondtab'">
            <ods-dataset-context context="regions,population"

                     regions-dataset="contours-geographiques-des-regions-2019-copy"
                     regions-domain="public"
                     regions-parameters="{'q':'NOT (guadeloupe OR mayotte OR guyane OR martinique OR reunion)'}"

                     population-dataset="population-millesimee-communes-2016"
                     population-domain="public">

    <div ng-init="colors = {};">

        <div ods-analysis="analyseregions"
             ods-analysis-context="population"
             ods-analysis-x="nom_reg"
             ods-analysis-max="0"
             ods-analysis-serie-agg="SUM(population_totale)"
             ods-analysis-sort="agg">
             {{ analyseregions }}
            <div ods-subaggregation="analyseregions.results"
                 ods-subaggregation-serie-maxval="MAX(agg)"
                 ods-subaggregation-serie-minval="MIN(agg)">
                <span ng-repeat="i in analyseregions.results">
                    {{colors[i.x] = "hsl(220,75%," +
                    (75 - ((i.agg - results[0].minval) / (results[0].maxval - results[0].minval) * 50) | number : 0) + "%,1)"; "" }}
                </span>
            </div>
        </div>

        <div class="map-container"
             ng-if="(colors|keys).length>0" >

            <ods-map style="height: 698px"
                     basemap="jawg.light"
                     no-refit="false" scroll-wheel-zoom="false" display-control="false" display-control-single-layer="true"
                     toolbar-fullscreen="true" toolbar-drawing="false">
                <ods-map-layer context="regions"
                               color-categories="colors"
                               color-by-field="region"
                               color-categories-other="lightgrey"
                               display="categories"
                               shape-opacity="0.7"
                               tooltip-disabled="true">
                </ods-map-layer>
            </ods-map>

        </div>

    </div>

</ods-dataset-context>
          </div>
          <div class="col-xs-12">
            <ods-map context="cases" ng-if="tabselector == 'thirdtab'"></ods-map>
          </div>
        </div>
      </div>

      <!-- <div class="row feature-box" ng-init="row-selector = {}">
        <div class="col-xs-12">
          <table class="summary-table">
            <thead>
              <th>Region</th>
              <th>Confirmed</th>
              <th>New</th>
              <th>hospitalized</th>
              <th>hospitalized UCI</th>
              <th>Altas</th>
              <th>Fatalities</th>
            </thead>
            <tbody>
              <tr ng-click="toggle1 = !toggle1" ng-class="{'selected' : toggle1}">
                <td>Lyon</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
              </tr>
              <tr ng-click="toggle2 = !toggle2" ng-class="{'selected' : toggle2}">
                <td>Paris</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
              </tr>
              <tr ng-click="toggle3 = !toggle3" ng-class="{'selected' : toggle3}">
                <td>Tours</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
                <td>42</td>
              </tr>
            </tbody>
          </table>
          <div class="col-xs-6">
            <ods-chart>
              <ods-chart-query timescale="day" context="cases" field-x="fecha">
                <ods-chart-serie expression-y="casos_confirmados" chart-type="spline">
                </ods-chart-serie>
              </ods-chart-query>
            </ods-chart>
          </div>
          <div class="col-xs-6"></div>
          <div class="col-xs-6">
            <ods-chart>
              <ods-chart-query timescale="day" context="cases" field-x="fecha">
                <ods-chart-serie expression-y="nuevos_positivos" chart-type="bar">
                </ods-chart-serie>
              </ods-chart-query>
            </ods-chart>
          </div>
        </div>
      </div> -->
    </ods-dataset-context>

  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.4.7/angular-sanitize.min.js"></script>
  <script type="text/javascript" src="https://opendatasoft.github.io/ods-widgets/dist/ods-widgets.js"></script>
</body>

</html>
